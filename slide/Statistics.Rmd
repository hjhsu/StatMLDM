---
title       : "統計與實務"
subtitle    : "Wush Wu and Johnson Hsieh"
framework   : io2012-wush
highlighter : highlight.js
hitheme     : zenburn
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
--- .largecontent &vcenter

```{r setup, include=FALSE, cache=FALSE}
library(knitr)
library(magrittr)
library(data.table)
library(dplyr)
library(ggplot2)
library(quantmod)
library(jsonlite)
library(binom)

opts_chunk$set(echo = FALSE, cache=FALSE, comment="",
               cache.path = "cache-Statistics/",
               dev.args=list(bg="transparent"),
               fig.path = "./assets/fig/rstatistics-",
               fig.width = 10, fig.height = 6)
fig <- function(path, size = 100) {
  sprintf("<img src='assets/img/%s' style='max-width: %d%%;max-height: %d%%'></img>",
          path, size, size)
}
fig2 <- function(path, size = 100) {
  sprintf("<img src='assets/img/%s' style='width: %d%%'></img>",
          path, size)
}
bg <- function(path) sprintf("bg:url(assets/img/%s)", path)
sys_name <- Sys.info()["sysname"] %>% tolower
sys_encode <- c("utf8", "utf8", "big5")[pmatch(sys_name, c("linux", "darwin", "windows"))]
sessionInfo() %>% capture.output %>% cat(file = "sessionInfo.log", sep = "\n")
construction <- local(suppressWarnings({
  construction <- fromJSON("construction.json")
  .tmp <-
    readLines("construction.txt") %>%
    strsplit(",") %>%
    extract2(1)
  .tmp2 <-
    regexec("(.*)\\((.*)\\)$", .tmp) %>%
    regmatches(x = .tmp)
  .tmp3 <- sapply(.tmp2, "[", 2)
  names(.tmp3) <-
    sapply(.tmp2, "[", 3) %>%
    toupper()
  .drop <- match(colnames(construction), names(.tmp3)) %>%
    is.na %>%
    which
  construction <- construction[,-.drop]
  colnames(construction) <- .tmp3[colnames(construction)]
  construction$X座標 <- as.numeric(construction$X座標)
  construction$Y座標 <- as.numeric(construction$Y座標)
  construction
}))
taipei.tax <- read.table(file("taipei-tax.csv", encoding = "UTF-8"), skip = 1, header = TRUE, sep = ",")
```

## 探索性資料分析

- 利用敘述性指標與圖表來觀察：
    - 資料的正確性
    - 資料的脈絡
    - 可能的因果關係
    - 可能的進階分析方向
    - 進階分析技術的假設是否正確
    - 可能的分析工具
    - 未來的數據收集方向

--- &vcenter .largecontent

## 敘述性統計指標

- 類別形變數
    - 次數：相對次數、絕對次數
- 數值形變數
    - 中心位置
    - 分散程度

--- &vcenter .largecontent

## 柏克萊大學申請入學資料

<center>`r fig("BerkeleyApply.png")`</center>

--- &vcenter .largecontent

## 計算次數

<center>`r fig("BerkeleyTable.png")`</center>

--- &vcenter .largecontent

## 計算次數

<center>`r fig("BerkeleyTable2.png")`</center>

--- &vcenter .largecontent

## 計算次數

<center>`r fig("HitRate.png")`</center>

--- &vcenter .largecontent

## 興光里綜合所得稅所得總額

```{r, taipei-tax1}
taipei.tax %>%
  filter(鄉鎮市區 == "文山區", 村里 == "興光里") %>%
  kable()
```
<small>單位：金額(千元)</small>

- (中心位置)平均: 1151, 中位數: 729
- (分散程度標準差: 1461.17, 四分位差: 991

--- &vcenter .largecontent

## 常態分佈 - 6 Sigma (標準差)

```{r normal}
curve(dnorm, -3, 3, xlab = "", ylab = "")
```

- 1 sigma: 68.3%, 2 sigma: 95.4%, 3 sigma: 99.7%

--- &vcenter .largecontent

## 興光里綜合所得稅所得總額

```{r, taipei-tax2}
taipei.tax %>%
  filter(鄉鎮市區 == "文山區", 村里 == "興光里") %>%
  kable()
```
<small>單位：金額(千元)</small>

- 平均 - 標準差 = -310.17
- 中位數: 729
- 第三分位數 - 中位數 $\approx$ 2 * (中位數 - 第一分位數) $\approx$ 4 * 第一分位數 
- 標準差異常的大

--- &vcenter .largecontent

## 模擬興光里的所得總額分佈

```{r taipei.tax2, warning=FALSE}
LunLane <- taipei.tax %>%
  filter(鄉鎮市區 == "文山區", 村里 == "興光里") 
alpha <- (LunLane$平均數 / LunLane$標準差)^2
beta <- LunLane$平均數 / LunLane$標準差^2
.x <- rgamma(floor(LunLane$綜合所得總額 / LunLane$平均數), shape = alpha, rate = beta)
.g <- qplot(.x, geom = "histogram", main = "")
suppressMessages(print(.g))
```

--- &vcenter .largecontent

## 台灣所得總額

<center>`r fig("taiwantax.png")`</center>

--- &fullimg `r bg("figure-meaning.png")`

--- &fullimg `r bg("graphic-meaning-1.png")`

--- &fullimg `r bg("graphic-meaning-2.png")`

--- &vcenter .largecontent

## 統計圖表做探索性資料分析

- 大量做圖
- 視覺化使資料有感
- 找出重要的因子與趨勢
- 看圖說故事
- 下一步

--- &vcenter .largecontent

## 繪圖原則

<center>`r fig("principle-of-graphics.png")`</center>

--- &fullimg `r bg("choosing-good-chart.png")`

- <http://extremepresentation.typepad.com/blog/2006/09/choosing_a_good.html>

--- &fullimg `r bg("mark-twain.png")`

--- &fullimg `r bg("party-property.png")`

--- &fullimg `r bg("unemployment.png")`

--- &twocol

## Pie Chart v.s. Bar Chart：哪一個最大？

*** =left

```{r pb-bar1}
df <- data.frame(
  type = head(letters, 4),
  value = c(31, 11, 30, 10)
)
g <- ggplot(df, aes(fill = type, y = value))
g + geom_bar(aes(x = type), stat = "identity")
```

*** =right

```{r pb-pie1, dependson="pb-bar1"}
g + 
  geom_bar(aes(x = ""), width = 1, stat = "identity", position = "stack") +
  coord_polar("y")
```

--- &twocol

## Pie Chart v.s. Bar Chart：有沒有過半?

*** =left

```{r pb-bar2}
df <- data.frame(
  type = head(letters, 3),
  value = c(30, 16, 17)
)
g <- ggplot(df, aes(fill = type, y = value))
g + geom_bar(aes(x = type), stat = "identity")
```

*** =right

```{r pb-pie2, dependson="pb-bar2"}
g + 
  geom_bar(aes(x = ""), width = 1, stat = "identity", position = "stack") +
  coord_polar("y")
```

--- &vcenter .largecontent

## 練習

```r
swirl::install_course_github("wush978", "StatMLDM", "course")
```

- DataScienceAndR
    - 03-RVisualization-01-One-Variable-Visualization
    - 03-RVisualization-02-Multiple-Variables-Visualization
    - 03-RVisualization-03-ggplot2
- StatMLDM
    - RStatistics-01-EDA

--- &fullimg `r bg("research-suicide.png")`

--- &vcenter .largecontent

## Correlation v.s. Causation

<a href="http://www.michaelnielsen.org/ddi/if-correlation-doesnt-imply-causation-then-what-does"><center>`r fig("correlation-bug.jpg")`</center></a>

--- &vcenter .largecontent

## Observation v.s. Experiment

- Observation
    - 資料的收集沒有控制
    - 不同欄位之間只有相關，沒有因果
- Experiment
    - 控制資料的收集
    - 控制可能影響的變數
    - 更接近因果

---

## 歐巴馬競選網站主視覺實驗 
<div style='text-align: center;'>
<h3>如何優化會員註冊率？</h3>
</div>
<div style="float:left;width:48%;" class="">
  <br>  
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/original-trial.png' />
  </div>
  <div style='text-align: center;'><h3>Original trial</h3></div>

</div>
<div style="float:right;width:48%;" class="">
  <br>
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/family-trial.png' />
  </div>
  <div style='text-align: center;'><h3>Family trial</h3></div>
</div>

---

## 歐巴馬競選網站主視覺實驗 - 原始資料 (示意)
<div style='text-align: center;'>
  <img width='90%' src='./assets/img/obama-election-data.png'/>
<div>

---

## 歐巴馬競選網站主視覺實驗 - 實驗結果
<div style='text-align: center;'>
  <img width='90%' src='./assets/img/obama-result.png'/>
<div>

*** =note

這裡是實驗的差距

實際上線後照比率估計則是6000萬美元的差距

Reference: <https://blog.optimizely.com/2010/11/29/how-obama-raised-60-million-by-running-a-simple-experiment/>

--- &vcenter .largecontent

## 關於A/B Testing
- 何謂AB測試?
- AB測試如何運作?
- AB測試為什麼該做？

--- &vcenter

## 何謂AB測試
<br>
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/what-is-abtesting.png'/>
</div>
<small>www.optimizely.com</small>

--- &vcenter

## AB測試如何運作
```{r abt-value}
library(ggplot2)
# AA test
set.seed(1)
x1 <- c(100, rnorm(6, -1, sd=1))
cx1 <- cumsum(x1)
cy1 <- cx1 + rnorm(7, 0, sd=0.5)

# AB test
x2 <- rnorm(20, -0.2, sd=1)
cx2 <- cumsum(c(x1,x2))
y2 <- rnorm(20, 0.2, sd=1)
cy2 <- c(cy1[-6], cumsum(c(cy1[6], y2)))

date <- seq.Date(from=as.Date("2016-03-07"), length.out = 27, by="day")
dat <- data.frame(method=rep(c("A","B"), each=27), 
           date=as.Date(rep(date,2)),
           value=c(cx2, cy2),
           cvalue=c(cumsum(cx2), cumsum(cy2)))
ggplot(dat, aes(x=date, y=value, color=method)) + 
  geom_line(lwd=1) +
  theme(text=element_text(size=18))
```

---&vcenter .largecontent

## AB測試為什麼該做
- 免窮理：don't necessarily know 'what works'
- 講證據：don't guess anymore
- 很簡單：don't have to be complicated or difficult to run
- 更經濟：don't have to cost a lot of money

--- &vcenter .largecontent

## AB測試基本原則
<br>
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/abt-principle.png'/>
</div>

--- &vcenter .largecontent

## 如何證明「烏鴉都是黑的」(Hempel 1945)
這個假設不會因為看見一隻黑色的烏鴉而獲得證明,    
不管看到多少隻黑色的烏鴉,都無法證明這個假設。
<div style='text-align: center;'>
  <img width='65%' src='./assets/img/RavenParadox-2.gif'/>
</div>


--- .largecontent

## 假設檢定的觀念 (testing hypothesis)
引進機率的概念,以「絕大部份」取代「所有」。    
假設黑烏鴉跟其他顏色的烏鴉比例是 99 : 1,    
你已經觀察到1000隻黑色烏鴉了, 在99:1的假設下,連續看到1000隻黑色烏鴉的機率是0.99^1000 = 0.00043,這個機率稱 p值。
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/abt-pvalue.png'/>
</div>

--- &vcenter .largecontent

## 檢定統計量(Ｔ值)
<br>
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/t-statistic.png'/>
</div>

--- &vcenter

## T統計量與P值
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/abt-pvalue2.jpg'/>
</div>
<small>http://goo.gl/PrlGsd</small>

--- .dark .segue

## 更多實務案例

--- .dark .segue

## 商品陳列也有A/B Testing

---

## 陳列畫面影響商品價值實驗 
<div style='text-align: center;'>
<h3>情境1. 用來裝飾房間的中國結</h3>
<small>http://goo.gl/qxijE8</small>
</div>
<div style="float:left;width:48%;" class="">
  <br>  
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/knot-left.png' />
  </div>
  <div style='text-align: center;'><h3>整齊的中國結</h3></div>

</div>
<div style="float:right;width:48%;" class="">
  <br>
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/knot-right.png' />
  </div>
  <div style='text-align: center;'><h3>凌亂的中國結</h3></div>
</div>

---

## 陳列畫面影響商品價值實驗 
<div style='text-align: center;'>
<h3>情境2. 用來做課堂拆解練習的中國結</h3>
<small>http://goo.gl/qxijE8</small>
</div>
<div style="float:left;width:48%;" class="">
  <br>  
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/knot-left.png' />
  </div>
  <div style='text-align: center;'><h3>整齊的中國結</h3></div>

</div>
<div style="float:right;width:48%;" class="">
  <br>
  <div style='text-align: center;'>
    <img width='90%' src='./assets/img/knot-right.png' />
  </div>
  <div style='text-align: center;'><h3>凌亂的中國結</h3></div>
</div>

--- .dark .segue

## 提升慈善捐款的A/B Testing

--- &vcenter

## 哪種策略更能刺激捐款？
<div style='text-align: center;'>
  <img width='90%' src='./assets/img/smiletrain.png'/>
</div>

--- .dark .segue

## 幫助法院討債的A/B Testing

---

## 討債簡訊如信寫？
<div style='text-align: center;'>
  <img width='80%' src='./assets/img/abt-text.png'/>
  <small>https://goo.gl/yMe9jO</small>
</div>

--- &vcenter .largecontent

## Advanced A/B Testing
- 檢定水準
- 樣本數 / 測試時程
- 多重檢定
- 統計顯著 vs. 物理顯著 (商業顯著)
